<!DOCTYPE html>
<html>
  <head>
    <title>LAB 2: Vivado Tcl</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <!-- when changing the stylesheet file please see also remark below -->
    <link rel="stylesheet" type="text/css" href="styling.css" />
  </head>
  <body>
<!-- :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: -->
<!-- :::::::::: template pages come first ... skip to REALCONTENT ::::::::: -->
<!-- :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: -->
<textarea id="source">

layout: true
name: blank
styling: styling.css
styling-by: Martin Weitzel

<!--
  *****************************************************************************
  Template used for title page (only)
  *****************************************************************************
  Please change the 'styling-by:' attribute if you change the style-sheet.
-->

.stylehint[
Styled with [{{styling}}]({{styling}}) by {{styling-by}}
]

---
layout: true
name: plain
copyright: (CC) BY-SA
branding:  [Dipl.-Ing. Martin Weitzel](http://tbfe.de) &#8199;&#8199; LAB 2: Vivado Tcl
customer:  [PLC2 – Programmable Logic Competence Center](http://plc2.com)

<!--
  *****************************************************************************
  Template used for for pages NOT referring to any Info-Graphic
  *****************************************************************************
  The following attributes are mandatory FOR THE TEMPLATE PAGE and should
  simply be left empty if not meaningful.

  copyright: will be reproduced in each page footer first
  branding: will reproduced in each page footer next
  customer: will be reproduced in each page footer last

  As the above attributes are part of several page templates a global replace
  should be used for consistent changes.

  On pages USING THIS TEMPLATE the following attributes must be set:

  header: ## and header text (i.e. including the markdown formatting indicator)

-->

{{header}}

.pagefooter[
{{copyright}}: {{branding}} .plc2-logo[{{customer}}]
]

---
layout: true
name: linkinfo
copyright: (CC) BY-SA
branding:  [Dipl.-Ing. Martin Weitzel](http://tbfe.de) &#8199;&#8199; LAB 2: Vivado Tcl
customer:  [PLC2 – Programmable Logic Competence Center](http://plc2.com)

<!--
  *****************************************************************************
  Template used for for pages INTRODUCING to a new Info-Graphic
  *****************************************************************************
  On this kind of pages a size-reduced version of the whole info graphic will
  be reproduced and occupies approximately 2/3 of the page width. So only add
  little information, preferably links to later pages dealing with single
  sections of the info graphic.

  On pages USING THIS TEMPLATE the following attributes must be set:

  graphic: file path to of the infographic EXCLUDING the suffix.
  header: ## and header text (i.e. including the markdown formatting indicator)

-->

{{header}}

.infographic[
[![Info-Grafik](InfoGraphics/{{graphic}}.png)](InfoGraphics/{{graphic}}.png
                "Click to open – add [CTRL+] SHIFT for new [tabbed] window")
]

.pagefooter[
{{copyright}}: {{branding}} {{customer}} .plc2-logo[]
]

---
layout: false
template: blank
name: frontmatter

.title[
	LAB 2: Vivado  
	Advanced Tcl Scripting._[]
]

.subtitle[
	From Vivado GUI-Sessions  
	to Vivado Tcl Scripts
]

.F[:
In the Online Version of this Lab you can access additional help as part of
the *Presenters Notes* – just hit the `P`-key once …
]

[XILINX UG835]: http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_4/ug835-vivado-tcl-commands.pdf
[XILINX UG888]: http://www.xilinx.com/support/documentation/sw_manuals/xilinx2016_4/ug888-vivado-design-flows-overview-tutorial.pdf

???

(use +/- above to adjust the font size for convenient reading)

If you want to keep the electronic version of this lab **only**, there is also
the option to open this file in an editor and take notes.

To return to the normal view, now press the P-key once more.

<!--
If you want to put in meta-annotations, i.e. text that is not even shown
after pressing the P-key, simply use HTML comments, like it is done here.
-->

---
template:plain
header: ## Part 1: Non-Project Design Flow

.N.center[
The following is mainly based on [XILINX UG888] → *LAB 1*  
with putting on different emphasizes.
]

As a preparation:

* Start Vivado (in GUI Mode)

* Open Tutorial [XILINX UG888]

* There advance to

  * *Lab 1: Using the Non-Project Design Flow* (Page 9)

  * Advance the steps *there* as instructed to do so *here*

If you have **not** worked through that tutorial in the past, also skim through
the text of these steps while advancing over them, but safe the time to go into
all the actions proposed there.

---
template: plain
header: ### Part 1 / Step 1: Examine the Example Script

.N.center[
In [XILINX UG888] → *Lab 1* advance to *Step 1* (Page 9)
]

* In the Tcl Script (`…/create/bft_kintex7_batch.tcl`):
  * Which are Tcl comments?
  * Which are ordinary Tcl commands?
  * Which are commands added by Vivado?
  * Which are Vivado commands disabled by comments?
  
* For all **Vivado Tcl Commands** – **including those in comments** –
  lookup their description [XILINX UG835].
  
* For all **Standard Tcl Commands** locate the appropriate documentation,
  in some or another form of online manual.._[]

.F[:
If you work with Microsoft Windows consider to install the **free** stand-alone
Tcl/Tk implementation available as [ActiveTcl] from [Active State], a company
specializing in commercial IDEs for various Open Source Scripting Languages.
(If you navigate through their web site to the [ActiveTcl Download Page] it
appears they want some information about you and/or your company, but actually
you can also download the installer if you do not fill-in the web-form.)  
If you work with Linux (or any other OS in the *ix tradition) Tcl/Tk usually
has its own section in the online manual, with a command reference for e.g. the
Tcl command `puts` available as `man 3tcl puts`.  
Or just consult the documentation section on the official Tcl/Tk web-site:
http://tcl.tk/man/tcl8.5
]

[Active State]: https://www.activestate.com
[ActiveTcl]: https://www.activestate.com/activetcl
[ActiveTcl Download Page]: http://downloads.activestate.com/ActiveTcl/releases/8.6.4.1/ActiveTcl8.6.4.1.299124-win32-ix86-threaded.exe
  
---
template: plain
header: ### Part 1 / Step 2: Examine the Example Script

.N.center[
In [XILINX UG888] → *Lab 1* advance with *Step 2* (Page 9 and 10)
]

* **Before** and **after** executing Sub-Step 2-1 watch
  * the content of the directory where Vivado creates sub-directories for each
    new project,
  * **including** the directory-tree below of the project-specfic directory.

* Do this with
  * operating system facilities (like a file system explorer)
  * Tcl Commands from the Vivado Tcl Console
     * (Tcl Command Hint: `cd`, `pwd`, `glob`)

* If necessary, look-up the description of the required Tcl commands.._[]

.F[:
How to do this depends on whether you work on Microsoft Windows or Linux:  
on a system connected to the internet you may visit the documentation section
of the official Tcl/Tk web-site: http://tcl.tk/man/tcl8.5  
on Linux you may use the local online manual (if installed) via `man 3tcl …`;  
on Microsoft Windows (if you had installed Active State's Tcl implementation)
you may use the Active State Help Pages.
]

---
template: plain
header: ### Part 1 / Step 3a: Synthesizing the Design

.N.center[
In [XILINX UG888] → *Lab 1* advance to *Step 3* (Page 11)
]

* Work up to Sub-Step 3-2, then in the Vivado Tcl Console determine

  * the current working directory and
  * the value of the variable `outputDir`

* Using the appropriate Tcl Commands

  * create a list of all files contained in that directory and store it into
    two different Tcl variables
     * **before** and
     * **after**
  * you complete Sub-Step 3-2

* How many new files have been created?

  * Try to "calculate" the answer with the help of Tcl.._[]
     * (Tcl Command Hint: `llength` and `expr`)

* Again, if necessary look-up the description of these commands.

---
template: plain
header: ### Part 1 / Step 3b: Synthesizing the Design

.N.center[
In [XILINX UG888] → *Lab 1* still in *Step 3* (Page 11)
]

* Look-up the description of the Vivado Command `get_cells` in [XILINX UG835].

  * Use this command to create a list of all cells in the synthesized design.
    * Determine the number of cells.
    * Display the name of the first and last cell.
       * (Tcl Command Hint: `lindex`)

* Look-up the description of the Vivado Command `report_property` in
  [XILINX UG835]

  * Use this command to display **all** the properties together with their
    value
     * for the first cell and
     * the last cell in the list of the previous step.

---
template: plain
header: ### Part 1 / Step 4: Implementing the Design

.N.center[
In [XILINX UG888] → *Lab 1* continue with *Step 7* (Page 17)
]

* **Before** actually carrying out Sub-Step 7-2, review the description of the
  Vivado Tcl Commands used in [XILINX UG835].

* From the description guess how the equivalent action can be achieved via the
  Vivado GUI.
  * Confirm your guess by carrying out that step from the Viado GUI.
  * Closely watch the Vivado Console Output to determine whether you guessed
    right.
  
---
template: plain
header: ### Part 1 / Step 5: Opening a Design Checkpoint

.N.center[
In [XILINX UG888] → *Lab 1* continue with *Step 8* (Page 18)
]

* Carry out the steps as described via the Vivado GUI.

* For each step watch closely watch the Tcl Console Output.
  * Lookup the Vivado Commands executed in [XILINX UG835].

---
template: plain
header: ### Part 1 / Step 6: Exiting the Vivado Tool

.N.center[
In [XILINX UG888] → *Lab 1* continue with *Step 10* (Page 21)
]

* Review the files as suggested in Sub-Steps 10-3 and 10-4.

* Turn the Journal file into a Tcl Script to re-create the work done in
  the past Vivado session.
  * Locate the "clutter" introduced by the commands when you
     * were looking around for files;
     * explored the files in `outputDir` (with `glob` etc.)
     * explored the design (with `get_cells` and `get_properties`).

* In the file system browser remove the whole project directory,

* then re-create it using the Tcl Script you derived from the journal.

---
template:plain
header: ## Part 2: Project Design Flow

.N.center[
The following is mainly based on [XILINX UG888] → *LAB 2*  
with putting on different emphasizes.
]

As a preparation:

* Start Vivado (in GUI Mode)

* Open Tutorial [XILINX UG888]

* There advance to

  * *Lab 2: Using the Non-Project Design Flow* (Page 22)

  * Advance the steps *there* as instructed to do so *here*

If you have **not** worked through that tutorial in the past, also skim through
the text of these steps while advancing over them, but safe the time to go into
all the actions proposed there.

---
template: plain
header: ### Part 2 / Step 1: Creating a Project

.N.center[
In [XILINX UG888] → *Lab 2* advance to *Step 1* (Page 22)
]

* Create the project as described in Sub-Steps 1-1 to 1-22.

* Watch the Tcl Console Output for the actually executed Tcl Commands.
  * If have not yet experience with Vivado's Tcl Commands for Project Mode,
    also look-up the description for at least some of these commands in
    [XILINX UG835].

* After Sub-Step 1-22, check the files the project knows about:
  * Look-up the description of the Vivado Tcl Command `get_files` in
    [XILINX UG835].
  * What is the total number of files **with** and **without** internal._[]
    files?
  * What is the total number of HDL files (Verilog or VHDL, as determined by
    the suffix)?

.F[:
In case you need a hint: In the description of `get_files` look for the option
`-all`.
]

---
template: plain
header: ### Part 2 / Step 2: Synthesizing and Implementing the Design

.N.center[
In [XILINX UG888] → *Lab 2* advance to *Step 7* (Page 39)
]

* After Sub-Step 7-1, again determine the number of files known **with** and
  **without** internal files.

* Before Sub-Step 7-2, clear the Tcl Console Output Windows._[]

* After Sub-Step 7-2 determine
  * which commands **exactly** have been executed as part of implementing the
    design,
  * **including** the command options used, and
  * look-up the description of these commands in [XILINX UG835].

.F[:
You can do so by clicking trash-can icon on its left side.
]

---
template: plain
header: ### Part 2 / Step 3: Creating a Tcl Script from a Journal File

.N.center[
In [XILINX UG888] → *Lab 2* advance to *Step 11* (Page 47)
]

* Skip to section **Editing the Batch Project Script** (Page 49)

  * Run through (Sub-) Steps 1 to 6

* Continue with section **Running the Batch Project Script** (Page 50)

  * Run through (Sub-) Steps 1 to 4

.I[
You may also want to look-up the the Vivado Tcl Commands `write_project_tcl`
and `write_bd_tcl` in [XILINX UG835].
]

---
template: plain
header: ## CONGRATULATION

So far you have finished the second LAB …

… or at least reached the "meeting point" from which you will be picked up when
the course continues.

.N.center[
Depending on prior knowledge of Vivado Tcl Script you may have learned a lot of
new things or just recapitulated existing knowledge.
]

.pull-left[
If Vivado Tcl Scripting is rather new to you, now you should

* have a basic understanding how GUI actions relate to Tcl Commands
* in both, *Non-Project Mode* and *Project Mode*, and
* how to create initial version of a Tcl Script from a GUI session.
]
.pull-right[
If you had already prior knowledge of Vivado Tcl Scripting **and time allows**,
feel free to

* return to individual steps of this Lab,
* repeat them trying more variations, and
* use the tutor's presence to ask any question that may arise.
]

.center[
(There is also an optional third part to which you may advance now …)
]

---
template: plain
header: ### Optional Part 3 / Step 1: Restructure a Vivado Tcl Script

For one or both of the two scripts derived from

* `create_bft_kintex7_batch.tcl` (as part of [XILINX UG888])

while working through this *this* LAB *Part 1 / Step 6* and *Part 2 / Step*:

* Wrap Tcl sub-routines around its main parts to
  * set up the design sources,
  * run the synthesis,
  * run the implementation (placement, optimizations),
  * generate reports, and
  * write the bitstream file

* Call the above subroutines in their proper order from an additional
  another ("master") subroutine.

* But do **not place any direct call** to a subroutines in the Tcl script.._[]

.F[:
Instead expect from the Vivado Tcl Console the user will `source` the script to
get the subroutine definitions first, then either execute all of them in the
sequence predefined by the master subroutine, or alternatively run each step
individually, maybe with intervening actions via the Vivado GUI.
]

---
template: plain
header: ### Optional Part 3 / Step 2: Restructure a Vivado Tcl Script

* In the script identify parts of commands that are candidates for variation
  * the names of the reports or their destination,
  * details of the optimization steps,
  * …

* Accordingly parametrize
  * the subroutine(s) carrying out that step(s);
  * the master subroutine sequentially executing the steps.

* To the master subroutine add a `-help` option describing
  * its general purpose and
  * the parameterization.




</textarea>
<!-- :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: -->
<!-- ::::::::::::::::::::: )-: ereh TNETNOCLAER fo dne :::::::::::::::::::: -->
<!-- :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: -->
    <script src="remark.min.js" type="text/javascript">
    </script>
    <script type="text/javascript">
      var slideshow = remark.create({ highlightLanguage: 'tcl', highlightStyle: 'docco' });
    </script>
  </body>
</html>
